#!/usr/bin/env sh
set -eu

# If MATOMO_DATABASE_PASSWORD_FILE is provided and readable, export MATOMO_DATABASE_PASSWORD
if [ "${MATOMO_DATABASE_PASSWORD_FILE:-}" != "" ] && [ -r "${MATOMO_DATABASE_PASSWORD_FILE}" ]; then
  export MATOMO_DATABASE_PASSWORD="$(cat "${MATOMO_DATABASE_PASSWORD_FILE}")"
fi

# If MATOMO_SALT_FILE is mounted, export MATOMO_SALT (Matomo reads MATOMO_SALT)
# (Some Matomo setups can use salt; keeping it available for plugins/consistency.)
if [ -r "/run/secrets/matomo_salt" ]; then
  export MATOMO_SALT="$(cat /run/secrets/matomo_salt)"
fi

# Hand off to upstream entrypoint if present; otherwise execute CMD.
if [ -x "/entrypoint.sh" ]; then
  exec /entrypoint.sh "$@"
elif [ -x "/docker-entrypoint.sh" ]; then
  exec /docker-entrypoint.sh "$@"
else
  exec "$@"
fi
