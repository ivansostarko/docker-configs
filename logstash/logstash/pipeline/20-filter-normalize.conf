filter {
  # Basic ECS-ish normalization
  if ![event] { mutate { add_field => { "[event][dataset]" => "generic" } } }

  # If coming from Beats, it usually has agent/host fields already.
  if [log][file][path] and ![source] {
    mutate { add_field => { "source" => "%{[log][file][path]}" } }
  }

  # Timestamp safety: if beats didn't parse it, try anyway
  if [@timestamp] == nil and [timestamp] {
    date {
      match => ["timestamp", "ISO8601"]
      target => "@timestamp"
    }
  }

  # Guardrails: donâ€™t explode ES mappings with accidental huge fields
  mutate {
    strip => ["message"]
  }
}
